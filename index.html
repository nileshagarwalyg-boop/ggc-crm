<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Ganga Legend County - Cost Sheet</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    body{font-family:'Montserrat',sans-serif;background:#f5f5f5;color:#1a1a1a;font-size:14px;line-height:1.5}
    input,select,button,textarea{font-family:'Montserrat',sans-serif}
    :root{--primary:#1a2e44;--accent:#c8a45c;--accent-light:#e8d5a0;--card:#fff;--border:#e0e0e0;--text:#1a1a1a;--text2:#666;--muted:#999;--ok:#2e7d32;--ok-bg:#e8f5e9}

    @media print{
      .no-print{display:none!important}
      .print-show{display:block!important}
      body{background:#fff;font-size:10px}
    }

    .hdr{background:var(--primary);padding:16px;position:sticky;top:0;z-index:100}
    .hdr-row{display:flex;align-items:center;gap:12px}
    .hdr-logo{height:40px;object-fit:contain;border-radius:4px}
    .hdr-info{flex:1}
    .hdr-t{color:#fff;font-size:15px;font-weight:700;letter-spacing:.5px}
    .hdr-s{color:var(--accent);font-size:10px;font-weight:600;letter-spacing:2px;margin-top:2px}
    .hdr-btn{width:36px;height:36px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background:0 0;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px}
    .hdr-logins{display:flex;gap:6px;align-items:center}
    .hdr-login-btn{padding:6px 12px;border-radius:8px;font-size:10px;font-weight:700;cursor:pointer;border:1.5px solid rgba(255,255,255,.25);background:transparent;color:rgba(255,255,255,.7);letter-spacing:.3px;display:flex;align-items:center;gap:4px;white-space:nowrap;transition:all .2s}
    .hdr-login-btn:hover{border-color:rgba(255,255,255,.5);color:#fff}
    .hdr-login-btn.active{background:var(--accent);color:var(--primary);border-color:var(--accent)}

    .tabs{display:flex;gap:8px;padding:12px 16px;overflow-x:auto;background:var(--primary);-webkit-overflow-scrolling:touch}
    .tabs::-webkit-scrollbar{display:none}
    .tab{flex-shrink:0;padding:8px 16px;border-radius:20px;font-size:12px;font-weight:600;border:1.5px solid rgba(255,255,255,.15);background:0 0;color:rgba(255,255,255,.6);cursor:pointer;white-space:nowrap}
    .tab.on{background:var(--accent);color:var(--primary);border-color:var(--accent)}

    .sel{padding:12px 16px;background:#fff;border-bottom:1px solid var(--border);display:flex;flex-wrap:wrap;gap:8px}
    .sel select{flex:1 1 30%;min-width:0;padding:10px 12px;border-radius:8px;border:1.5px solid var(--border);font-size:13px;font-weight:500;background:#fff;color:var(--text);appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}

    .cnt{padding:16px}
    .card{background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:12px}
    .card-h{padding:14px 16px;background:var(--primary);display:flex;align-items:center;justify-content:space-between}
    .card-h h3{color:#fff;font-size:13px;font-weight:700;letter-spacing:.3px}
    .card-h .badge{font-size:10px;color:var(--accent);font-weight:600}

    .row{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #f0f0f0}
    .row:last-child{border-bottom:0}
    .row-l{flex:1}
    .row-t{font-size:13px;font-weight:600;color:var(--text)}
    .row-s{font-size:11px;color:var(--muted);margin-top:2px}
    .row-a{font-size:15px;font-weight:700;color:var(--text);text-align:right}
    .row-lk{font-size:11px;color:var(--text2);font-weight:500;text-align:right}
    .row.sub .row-t{color:var(--text2);font-weight:500;font-size:12px;padding-left:12px}
    .row.sub .row-a{font-size:13px;font-weight:600;color:var(--text2)}
    .row.tot{background:var(--primary)}
    .row.tot .row-t{color:#fff;font-size:14px}
    .row.tot .row-a{color:var(--accent);font-size:18px}
    .row.tot .row-lk{color:var(--accent-light)}

    .chips{display:flex;gap:10px;overflow-x:auto;padding:16px;-webkit-overflow-scrolling:touch}
    .chips::-webkit-scrollbar{display:none}
    .chip{flex-shrink:0;width:155px;padding:14px;border-radius:10px;border:1.5px solid var(--border);background:#fff;cursor:pointer}
    .chip.on{background:var(--primary);border-color:var(--accent)}
    .chip-n{font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.5px}
    .chip.on .chip-n{color:var(--accent)}
    .chip-a{font-size:10px;color:var(--muted);margin-top:2px}
    .chip.on .chip-a{color:rgba(255,255,255,.5)}
    .chip-p{font-size:16px;font-weight:800;color:var(--text);margin-top:8px}
    .chip.on .chip-p{color:#fff}
    .chip-l{font-size:10px;color:var(--muted);margin-top:2px}
    .chip.on .chip-l{color:var(--accent-light)}

    .slab{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #f0f0f0}
    .slab:last-child{border-bottom:0}
    .slab-f{font-size:13px;font-weight:600;display:flex;align-items:center;gap:8px}
    .slab-d{width:8px;height:8px;border-radius:50%}
    .slab-r{font-size:12px;color:var(--text2);font-weight:600}
    .slab-p{font-size:14px;font-weight:700;text-align:right}
    .slab-l{font-size:10px;color:var(--muted);text-align:right}

    .info{display:flex;align-items:center;gap:10px;padding:12px 16px;border-bottom:1px solid #f0f0f0;font-size:12px}
    .info:last-child{border-bottom:0}
    .info-i{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;font-weight:700}
    .info-i.g{background:#fef3c7;color:#92400e}
    .info-lb{font-weight:700;font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
    .info-v{font-weight:600;color:var(--text);margin-top:1px}

    .offer{background:linear-gradient(135deg,#1a2e44,#2c4a6e);border-radius:12px;overflow:hidden;margin:0 16px 12px;box-shadow:0 2px 12px rgba(26,46,68,.3)}
    .offer-h{background:var(--accent);padding:10px 16px;text-align:center}
    .offer-h span{font-size:11px;font-weight:800;color:var(--primary);text-transform:uppercase;letter-spacing:1.5px}
    .offer-b{padding:20px 16px;text-align:center}
    .offer-t{font-size:16px;font-weight:800;color:#fff;margin-bottom:8px}
    .offer-hl{display:inline-block;background:var(--accent);color:var(--primary);padding:4px 12px;border-radius:6px;font-size:13px;font-weight:800;margin:8px 0}
    .offer-s{font-size:11px;color:rgba(255,255,255,.6);margin-top:8px;font-weight:500}

    .tc{padding:16px;font-size:12px;line-height:1.8;color:var(--text2)}
    .tc ol{padding-left:20px;margin:0 0 16px}
    .tc li{padding:4px 0}
    .tc b{color:var(--text)}
    .tc-dis{margin-top:12px;padding:12px;background:#fef9ee;border-left:3px solid var(--accent);border-radius:4px;font-size:11px;line-height:1.7}
    .tc-inc{margin-top:12px;font-size:11px;line-height:1.7}
    .ft{padding:12px 16px;text-align:center;font-size:10px;color:var(--muted);border-top:1px solid var(--border);background:#fff}

    /* Modal overlay */
    .modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:500;align-items:center;justify-content:center;padding:20px}
    .modal-bg.show{display:flex}
    .modal{background:#fff;border-radius:16px;width:100%;max-width:400px;max-height:90vh;overflow-y:auto;box-shadow:0 8px 32px rgba(0,0,0,.3)}
    .modal-hd{background:var(--primary);padding:16px;border-radius:16px 16px 0 0;display:flex;align-items:center;justify-content:space-between}
    .modal-hd h3{color:#fff;font-size:14px;font-weight:700}
    .modal-cls{background:0 0;border:0;color:rgba(255,255,255,.6);font-size:22px;cursor:pointer;padding:0 4px}
    .modal-body{padding:20px}

    /* Admin rate config */
    .adm-section{margin-bottom:20px}
    .adm-section h4{font-size:12px;font-weight:700;color:var(--primary);text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px;padding-bottom:8px;border-bottom:2px solid var(--accent)}
    .adm-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0}
    .adm-row:last-child{border-bottom:0}
    .adm-lbl{font-size:12px;font-weight:600;color:var(--text);flex:1}
    .adm-lbl small{display:block;font-size:10px;color:var(--muted);font-weight:400;margin-top:1px}
    .adm-inp{width:110px;padding:8px 10px;border-radius:8px;border:1.5px solid var(--border);font-size:13px;font-weight:600;text-align:right;outline:none}
    .adm-inp:focus{border-color:var(--accent)}
    .adm-save{width:100%;padding:14px;background:var(--ok);color:#fff;border:0;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;margin-top:16px}
    .adm-save:active{opacity:.8}
    .adm-toast{display:none;padding:10px;background:var(--ok-bg);color:var(--ok);font-size:12px;font-weight:600;text-align:center;border-radius:8px;margin-top:10px}
    .adm-rise{font-size:11px;color:var(--accent);font-weight:600;background:#fef9ee;padding:8px 12px;border-radius:8px;text-align:center;margin-bottom:12px}

    /* Login form */
    .login-f{display:flex;flex-direction:column;gap:14px}
    .login-f label{font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.5px}
    .login-f input{padding:12px;border-radius:8px;border:1.5px solid var(--border);font-size:14px;font-weight:500;outline:none}
    .login-f input:focus{border-color:var(--accent)}
    .login-btn{padding:14px;background:var(--primary);color:#fff;border:0;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer}
    .login-btn:active{opacity:.8}
    .login-err{color:#d32f2f;font-size:12px;font-weight:600;text-align:center;display:none}
  </style>
</head>
<body>

<div class="hdr no-print">
  <div class="hdr-row">
    <img id="logo" src="Logo file.png" alt="Logo" class="hdr-logo">
    <div class="hdr-info">
      <div class="hdr-t">Ganga Legend County</div>
      <div class="hdr-s">FIXED PRICE</div>
    </div>
    <div class="hdr-logins">
      <button class="hdr-login-btn" id="hdrLoginBtn" onclick="openAdmin()" title="Admin">
        <span>&#9881;</span> <span id="hdrLoginLabel">Admin</span>
      </button>
      <button class="hdr-btn" onclick="window.print()" title="Print">&#128424;</button>
    </div>
  </div>
</div>

<!-- ============ COST SHEET SECTION ============ -->
<div id="section-cs">
  <div class="tabs no-print" id="tabs"></div>
  <div class="sel no-print">
    <select id="tSel"></select>
    <select id="fSel"></select>
    <select id="uSel"></select>
  </div>
  <div class="cnt" id="out"></div>

  <!-- OFFER -->
  <div class="offer">
    <div class="offer-h"><span>This Month's Special Offer</span></div>
    <div class="offer-b">
      <div class="offer-t">Book Today & Get</div>
      <div class="offer-hl">1 Year FREE Membership at ILESEUM Club</div>
      <div class="offer-s">*Offer valid for bookings made this month only. Terms apply.</div>
    </div>
  </div>

  <!-- T&C -->
  <div class="card" style="margin:0 16px 16px">
    <div class="card-h"><h3>Terms & Conditions</h3></div>
    <div class="tc">
      <ol>
        <li>Agreement value is calculated on <b>Flat Carpet Area Only</b>. 1 Sq.m = 10.764 Sq.ft.</li>
        <li>Government Taxes <b>subject to change</b>. Legal Charges extra, applicable at time of Agreement.</li>
        <li>Booking Amount: <b>10%</b></li>
        <li>Maintenance proposed for <b>24 months</b> or until funds utilized, whichever is earlier. <b>Rs.5/sq.ft.</b> plus taxes on total carpet area, payable before possession.</li>
        <li>All Cheques in favour of: <b>"Legends County Landmark Pvt Ltd" A/C</b></li>
      </ol>
      <div class="tc-dis">
        <b>Disclaimer:</b> This cost sheet is for reference only and does not constitute an offer or legal commitment. Prices, plans, and specifications are subject to change without prior notice. Final terms as per Agreement to Sale.
      </div>
      <div class="tc-inc">
        Inclusive of <b>Covered Parking</b> as per unit type. Inclusive of Taxes.
      </div>
    </div>
    <div class="ft">Ganga Legend County &mdash; Legends County Landmark Pvt Ltd</div>
  </div>

  <!-- UNICON FOOTER -->
  <div style="padding:20px 16px 24px;text-align:center">
    <img src="unicon logo.png" alt="Unicon" style="height:40px;object-fit:contain;margin-bottom:6px;mix-blend-mode:multiply">
    <div style="font-size:10px;font-weight:600;color:var(--muted);letter-spacing:.5px">An Innovation by Unicon Real Estate Solutions</div>
  </div>
</div>

<!-- ADMIN MODAL (Rate Configuration) -->
<div class="modal-bg" id="adminModal">
  <div class="modal">
    <div class="modal-hd"><h3>&#9881; Rate Configuration</h3><button class="modal-cls" onclick="closeAdmin()">&times;</button></div>
    <div class="modal-body">
      <div class="login-f" id="adminLogin">
        <div>
          <label>Password</label>
          <input type="password" id="adm-pass" autocomplete="off" placeholder="Enter admin password">
        </div>
        <div class="login-err" id="loginErr">Invalid password</div>
        <button class="login-btn" onclick="doAdminLogin()">Unlock</button>
      </div>
      <div id="adminPanel" style="display:none">
        <div class="adm-rise">Floor Rise: &#8377;150/sqft per 5-floor slab</div>
        <div class="adm-section">
          <h4>Base Rates (per sqft)</h4>
          <div id="rateInputs"></div>
        </div>
        <button class="adm-save" onclick="saveRates()">&#128190; Save Rates</button>
        <div class="adm-toast" id="admToast">Rates saved successfully!</div>
      </div>
    </div>
  </div>
</div>

<script>
/* ============================================================
   DATA & STATE
   ============================================================ */
var FLOOR_RISE = 150;
var SLABS = [
  {l:'1st-5th Floor',a:1,b:5,k:'1-5',m:0},
  {l:'6th-10th Floor',a:6,b:10,k:'6-10',m:1},
  {l:'11th-15th Floor',a:11,b:15,k:'11-15',m:2},
  {l:'16th-20th Floor',a:16,b:20,k:'16-20',m:3},
  {l:'21st-27th Floor',a:21,b:27,k:'21-27',m:4}
];

var D={
  B5:{
    name:'B5 Tower',rera:'P52100076756',
    base:12500,
    units:[
      {n:'3 BHK',sq:1262,pk:'2 Covered Parking'},
      {n:'3 BHK',sq:1272,pk:'2 Covered Parking'},
      {n:'3.5 BHK',sq:1402,pk:'2 Covered Parking'},
      {n:'3.5 BHK',sq:1470,pk:'2 Covered Parking'}
    ]
  },
  B7:{
    name:'B7 Tower',rera:'P52100076968',
    base:13500,
    units:[
      {n:'4 BHK A',sq:1411,pk:'2 Covered Parking'},
      {n:'4 BHK B',sq:1294,pk:'2 Covered Parking'},
      {n:'3 BHK A',sq:1222,pk:'2 Covered Parking'},
      {n:'2.5 BHK',sq:1030,pk:'1 Covered Parking'},
      {n:'1.5 BHK (Refuge)',sq:821,pk:'1 Covered Parking'}
    ],
    flats:[]
  }
};

/* Generate B7 flat inventory (216 units, 8 per floor, floors 1-27) */
(function genB7Flats(){
  var STD=[
    {pos:'01',type:'4 BHK A',sq:1411,pk:'2 Covered Parking'},
    {pos:'02',type:'4 BHK B',sq:1294,pk:'2 Covered Parking'},
    {pos:'03',type:'2.5 BHK B',sq:1030,pk:'1 Covered Parking'},
    {pos:'04',type:'3 BHK A',sq:1222,pk:'2 Covered Parking'},
    {pos:'05',type:'4 BHK B',sq:1294,pk:'2 Covered Parking'},
    {pos:'06',type:'4 BHK A',sq:1411,pk:'2 Covered Parking'},
    {pos:'07',type:'3 BHK B',sq:1222,pk:'2 Covered Parking'},
    {pos:'08',type:'2.5 BHK A',sq:1030,pk:'1 Covered Parking'}
  ];
  var RF=[7,12,17,22];
  var flats=[];
  for(var f=1;f<=27;f++){
    var isRef=RF.indexOf(f)!==-1;
    for(var p=0;p<STD.length;p++){
      var s=STD[p];
      var flatNo=f*100+(p+1);
      if(isRef && (s.pos==='03'||s.pos==='08')){
        flats.push({no:flatNo,type:'1.5 BHK (Refuge)',sq:821,floor:f,pk:'1 Covered Parking',ref:true});
      }else{
        flats.push({no:flatNo,type:s.type,sq:s.sq,floor:f,pk:s.pk,ref:false});
      }
    }
  }
  D.B7.flats=flats;
})();

var SD=7,GST=5,REG=30000,SCAN=10000,BOOK=10;

/* Load saved rates from localStorage */
(function loadSavedRates(){
  try{
    var saved=localStorage.getItem('ggc_admin_rates');
    if(saved){
      var data=JSON.parse(saved);
      Object.keys(data).forEach(function(bk){
        if(D[bk]&&data[bk].base&&data[bk].base>0){
          D[bk].base=data[bk].base;
        }
      });
    }
  }catch(e){}
})();

var S={bld:'B5',sf:1,su:0,fi:0,ft:'',ff:0};
var SC=['#d1d5db','#9ca3af','#6b7280','#4b5563','#374151'];

/* ============================================================
   COST SHEET LOGIC
   ============================================================ */
function slabRate(base,si){ return base + (si * FLOOR_RISE); }

function getRates(bKey){
  var b=D[bKey]; var r={};
  for(var i=0;i<SLABS.length;i++) r[SLABS[i].k]=slabRate(b.base,i);
  return r;
}

function calcTP(rate,sqft){ return Math.ceil(rate*sqft*112/100000)*1000; }

function getTP(bKey,ui,floor){
  var b=D[bKey]; var u=b.units[ui];
  var si=floorToSlabIdx(floor);
  var rate=slabRate(b.base,si);
  return calcTP(rate,u.sq);
}

function floorToSlabIdx(f){
  for(var i=0;i<SLABS.length;i++){
    if(f>=SLABS[i].a&&f<=SLABS[i].b) return i;
  }
  return 0;
}

function sl(f){return SLABS[floorToSlabIdx(f)];}

function f$(n){if(n==null||isNaN(n))return'\u20B90';var s=Math.round(Math.abs(n)).toString(),r='',c=0;for(var i=s.length-1;i>=0;i--){c++;r=s[i]+r;if(i>0){if(c===3&&s.length>3)r=','+r;else if(c>3&&(c-3)%2===0)r=','+r;}}return(n<0?'-':'')+'\u20B9'+r;}
function fL(n){if(!n)return'';var l=n/1e5;return l>=100?'\u20B9'+(l/100).toFixed(2)+' Cr':'\u20B9'+l.toFixed(2)+' L';}

function calc(bKey,ui,f){
  var t=getTP(bKey,ui,f);
  var av=t/1.12;
  return{tp:t,av:av,sd:av*(SD/100),gs:av*(GST/100),reg:REG,scn:SCAN,gt:t+REG+SCAN};
}

function calcFlat(bKey,flatObj){
  var b=D[bKey];
  var si=floorToSlabIdx(flatObj.floor);
  var rate=slabRate(b.base,si);
  var t=calcTP(rate,flatObj.sq);
  var av=t/1.12;
  return{tp:t,av:av,sd:av*(SD/100),gs:av*(GST/100),reg:REG,scn:SCAN,gt:t+REG+SCAN,rate:rate};
}

function go(){
  var te=document.getElementById('tabs');te.innerHTML='';
  Object.keys(D).forEach(function(k){
    var bt=document.createElement('button');
    bt.className='tab'+(S.bld===k?' on':'');
    bt.textContent=D[k].name;
    bt.onclick=function(){S.bld=k;S.su=0;S.sf=1;S.fi=0;S.ft='';S.ff=0;go();};
    te.appendChild(bt);
  });

  var b=D[S.bld];
  var hasFlats=b.flats&&b.flats.length>0;
  var ts=document.getElementById('tSel');
  var fs=document.getElementById('fSel');
  var us=document.getElementById('uSel');

  var selFlat,selUnit,selFloor,selSq,selPk,selType,c;

  if(hasFlats){
    ts.style.display='';
    fs.style.display='';
    us.style.display='';

    var types=[];
    b.flats.forEach(function(fl){if(types.indexOf(fl.type)===-1)types.push(fl.type);});
    ts.innerHTML='';
    var oAll=document.createElement('option');oAll.value='';oAll.textContent='All Flat Types';oAll.selected=S.ft==='';ts.appendChild(oAll);
    types.forEach(function(t){var o=document.createElement('option');o.value=t;o.textContent=t;o.selected=t===S.ft;ts.appendChild(o);});
    ts.onchange=function(){S.ft=this.value;S.ff=0;S.fi=0;go();};

    var typeFiltered=S.ft?b.flats.filter(function(fl){return fl.type===S.ft;}):b.flats;

    var floors=[];
    typeFiltered.forEach(function(fl){if(floors.indexOf(fl.floor)===-1)floors.push(fl.floor);});
    floors.sort(function(a,b){return a-b;});
    fs.innerHTML='';
    var oAllF=document.createElement('option');oAllF.value='0';oAllF.textContent='All Floors';oAllF.selected=S.ff===0;fs.appendChild(oAllF);
    floors.forEach(function(f){var o=document.createElement('option');o.value=f;o.textContent='Floor '+f;o.selected=f===S.ff;fs.appendChild(o);});
    fs.onchange=function(){S.ff=+this.value;S.fi=0;go();};

    var filtered=S.ff?typeFiltered.filter(function(fl){return fl.floor===S.ff;}):typeFiltered;

    us.innerHTML='';
    var foundCurrent=false;
    filtered.forEach(function(flat){
      var idx=b.flats.indexOf(flat);
      var o=document.createElement('option');
      o.value=idx;
      o.textContent='Flat '+flat.no+' \u2014 '+flat.type+' ('+flat.sq+' sqft)';
      if(idx===S.fi){o.selected=true;foundCurrent=true;}
      us.appendChild(o);
    });
    if(!foundCurrent&&filtered.length>0){
      S.fi=b.flats.indexOf(filtered[0]);
      us.firstChild.selected=true;
    }
    us.onchange=function(){S.fi=+this.value;go();};

    selFlat=b.flats[S.fi]||b.flats[0];
    selFloor=selFlat.floor;
    selSq=selFlat.sq;
    selPk=selFlat.pk;
    selType=selFlat.type;
    c=calcFlat(S.bld,selFlat);
  }else{
    ts.style.display='none';

    us.innerHTML='';
    b.units.forEach(function(u,i){var o=document.createElement('option');o.value=i;o.textContent=u.n+' ('+u.sq+' sqft)';o.selected=i===S.su;us.appendChild(o);});
    us.onchange=function(){S.su=+this.value;go();};

    fs.style.display='';
    fs.innerHTML='';
    for(var f=1;f<=27;f++){var s=sl(f);var o=document.createElement('option');o.value=f;o.textContent='Floor '+f+' \u2014 '+s.l;o.selected=f===S.sf;fs.appendChild(o);}
    fs.onchange=function(){S.sf=+this.value;go();};

    selUnit=b.units[S.su]||b.units[0];
    selFloor=S.sf;
    selSq=selUnit.sq;
    selPk=selUnit.pk;
    selType=selUnit.n;
    c=calc(S.bld,S.su,S.sf);
  }

  var h='';

  // Print header
  h+='<div class="card print-show" style="display:none;margin-bottom:12px"><div style="padding:16px;background:var(--primary);display:flex;align-items:center;gap:12px"><img src="'+document.getElementById('logo').src+'" style="height:36px"><div style="flex:1"><div style="color:#fff;font-size:14px;font-weight:700">Ganga Legend County</div><div style="color:var(--accent);font-size:10px">FIXED PRICE | RERA: '+b.rera+'</div></div><div style="color:rgba(255,255,255,.6);font-size:10px">'+new Date().toLocaleDateString('en-IN')+'</div></div></div>';

  // Unit type chips
  h+='<div style="margin:0 -16px 12px"><div class="chips">';
  if(hasFlats){
    var si=floorToSlabIdx(selFloor);
    var rate=slabRate(b.base,si);
    b.units.forEach(function(unit,i){
      var p=calcTP(rate,unit.sq);
      var on=selType===unit.n||(selType.indexOf(unit.n)===0);
      h+='<div class="chip'+(on?' on':'')+'" style="cursor:default"><div class="chip-n">'+unit.n+'</div><div class="chip-a">'+unit.sq+' sqft</div><div class="chip-p">'+f$(p)+'</div><div class="chip-l">'+fL(p)+'</div></div>';
    });
  }else{
    b.units.forEach(function(unit,i){
      var p=getTP(S.bld,i,S.sf),on=i===S.su;
      h+='<div class="chip'+(on?' on':'')+'" onclick="S.su='+i+';go()"><div class="chip-n">'+unit.n+'</div><div class="chip-a">'+unit.sq+' sqft</div><div class="chip-p">'+f$(p)+'</div><div class="chip-l">'+fL(p)+'</div></div>';
    });
  }
  h+='</div></div>';

  // Selected flat badge
  var badge=hasFlats?'Flat '+selFlat.no+' | '+selType+' | Floor '+selFloor:selType+' | Floor '+selFloor;

  // Cost breakdown
  h+='<div class="card"><div class="card-h"><h3>Cost Breakdown</h3><span class="badge">'+badge+'</span></div>';
  h+='<div class="row"><div class="row-l"><div class="row-t">Total Package</div><div class="row-s">Inclusive of Stamp Duty & GST</div></div><div><div class="row-a">'+f$(c.tp)+'</div><div class="row-lk">'+fL(c.tp)+'</div></div></div>';
  h+='<div class="row sub"><div class="row-l"><div class="row-t">Agreement Value</div></div><div><div class="row-a">'+f$(c.av)+'</div></div></div>';
  h+='<div class="row sub"><div class="row-l"><div class="row-t">Stamp Duty @ '+SD+'%</div></div><div><div class="row-a">'+f$(c.sd)+'</div></div></div>';
  h+='<div class="row sub"><div class="row-l"><div class="row-t">GST @ '+GST+'%</div></div><div><div class="row-a">'+f$(c.gs)+'</div></div></div>';
  h+='<div class="row"><div class="row-l"><div class="row-t">Registration</div><div class="row-s">Fixed</div></div><div><div class="row-a">'+f$(c.reg)+'</div></div></div>';
  h+='<div class="row"><div class="row-l"><div class="row-t">Scanning & Documentation</div><div class="row-s">Fixed</div></div><div><div class="row-a">'+f$(c.scn)+'</div></div></div>';
  h+='<div class="row tot"><div class="row-l"><div class="row-t">Grand Total</div></div><div><div class="row-a">'+f$(c.gt)+'</div><div class="row-lk">'+fL(c.gt)+'</div></div></div>';
  h+='</div>';

  // Info
  h+='<div class="card">';
  if(hasFlats) h+='<div class="info"><div class="info-i g">F</div><div><div class="info-lb">Flat Number</div><div class="info-v">Flat '+selFlat.no+'</div></div></div>';
  h+='<div class="info"><div class="info-i g">P</div><div><div class="info-lb">Parking</div><div class="info-v">'+selPk+'</div></div></div>';
  h+='<div class="info"><div class="info-i g">R</div><div><div class="info-lb">RERA Number</div><div class="info-v">'+b.rera+'</div></div></div>';
  h+='<div class="info"><div class="info-i g">B</div><div><div class="info-lb">Booking Amount</div><div class="info-v">'+BOOK+'% of Agreement Value ('+f$(c.av*(BOOK/100))+')</div></div></div>';
  h+='</div>';

  // Floor-wise pricing
  h+='<div class="card"><div class="card-h"><h3>Floor-wise Pricing</h3><span class="badge">'+selType+' ('+selSq+' sqft)</span></div>';
  SLABS.forEach(function(s,i){
    var rate=slabRate(b.base,i);
    var p=calcTP(rate,selSq);
    var on=selFloor>=s.a&&selFloor<=s.b;
    h+='<div class="slab" style="'+(on?'background:#f0f7ff':'')+'"><div><div class="slab-f"><span class="slab-d" style="background:'+SC[i]+'"></span>'+s.l+'</div><div class="slab-r">'+f$(rate)+'/sqft</div></div><div><div class="slab-p">'+f$(p)+'</div><div class="slab-l">'+fL(p)+'</div></div></div>';
  });
  h+='</div>';

  document.getElementById('out').innerHTML=h;
}

/* ============================================================
   ADMIN (Rate Config â€” password protected, localStorage)
   ============================================================ */
var ADMIN_PASS='ggc2024'; // Simple admin password

function openAdmin(){
  document.getElementById('adminModal').classList.add('show');
  document.getElementById('adm-pass').value='';
  document.getElementById('loginErr').style.display='none';
  // If already unlocked in this session, show panel directly
  if(document.getElementById('adminPanel').style.display==='block'){
    document.getElementById('adminLogin').style.display='none';
    showRatePanel();
  }else{
    document.getElementById('adminLogin').style.display='';
    document.getElementById('adminPanel').style.display='none';
  }
}

function closeAdmin(){
  document.getElementById('adminModal').classList.remove('show');
}

function doAdminLogin(){
  var p=document.getElementById('adm-pass').value.trim();
  if(p===ADMIN_PASS){
    document.getElementById('adminLogin').style.display='none';
    document.getElementById('adminPanel').style.display='block';
    showRatePanel();
  }else{
    document.getElementById('loginErr').style.display='block';
  }
}

function showRatePanel(){
  var h='';
  Object.keys(D).forEach(function(bk){
    h+='<div class="adm-row">';
    h+='<div class="adm-lbl">'+D[bk].name+'<small>Current: '+f$(D[bk].base)+'/sqft</small></div>';
    h+='<input class="adm-inp" type="number" id="rate_'+bk+'" value="'+D[bk].base+'">';
    h+='</div>';
  });
  document.getElementById('rateInputs').innerHTML=h;
}

function saveRates(){
  var data={};
  Object.keys(D).forEach(function(bk){
    var val=+document.getElementById('rate_'+bk).value;
    if(val>0){
      D[bk].base=val;
      data[bk]={base:val};
    }
  });
  localStorage.setItem('ggc_admin_rates',JSON.stringify(data));
  go();
  var t=document.getElementById('admToast');
  t.style.display='block';
  setTimeout(function(){t.style.display='none';},2000);
}

/* ============================================================
   INIT
   ============================================================ */
go();
</script>

</body>
</html>
